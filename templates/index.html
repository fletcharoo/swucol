{{define "index"}}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SWU Collection Manager</title>
	<script src="https://unpkg.com/htmx.org@2.0.4/dist/htmx.min.js"></script>
	<style>
		*, *::before, *::after {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		body {
			background: #1f1f1f;
			color: #ffffff;
			font-family: system-ui, -apple-system, sans-serif;
			min-height: 100vh;
		}

		/* Top bar */
		.top-bar {
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 16px 24px;
			background: #2a2a2a;
			border-bottom: 1px solid #3a3a3a;
			position: sticky;
			top: 0;
			z-index: 10;
		}

		.search-input {
			flex: 1;
			padding: 10px 14px;
			border-radius: 6px;
			border: none;
			font-size: 1rem;
			background: #ffffff;
			color: #111111;
			outline: none;
		}

		.search-input:focus {
			box-shadow: 0 0 0 2px #555555;
		}

		.import-btn {
			padding: 10px 20px;
			border-radius: 6px;
			border: none;
			background: #ffffff;
			color: #111111;
			font-size: 0.95rem;
			font-weight: 600;
			cursor: pointer;
			white-space: nowrap;
		}

		.import-btn:hover {
			background: #e8e8e8;
		}

		.nav-link {
			padding: 10px 20px;
			border-radius: 6px;
			border: 1px solid #555555;
			background: transparent;
			color: #ffffff;
			font-size: 0.95rem;
			font-weight: 600;
			cursor: pointer;
			white-space: nowrap;
			text-decoration: none;
		}

		.nav-link:hover {
			background: #3a3a3a;
		}

		/* Card grid */
		#card-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
			gap: 16px;
			padding: 24px;
		}

		/* Card tile */
		.card-tile {
			background: #ffffff;
			color: #111111;
			border-radius: 8px;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}

		.card-tile img {
			width: 100%;
			height: 180px;
			object-fit: contain;
			background: #eeeeee;
			display: block;
		}

		.card-no-image {
			width: 100%;
			height: 180px;
			background: #cccccc;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 0.8rem;
			color: #666666;
		}

		.card-info {
			padding: 10px;
			display: flex;
			flex-direction: column;
			flex: 1;
			gap: 8px;
		}

		.card-name {
			font-size: 0.82rem;
			font-weight: 600;
			line-height: 1.35;
			word-break: break-word;
			flex: 1;
		}

		/* Owned row â€” also used as the htmx swap target */
		.owned-row {
			display: flex;
			align-items: center;
			justify-content: space-between;
		}

		.owned-count {
			font-size: 0.85rem;
			color: #333333;
		}

		.owned-controls {
			display: flex;
			gap: 4px;
		}

		.owned-btn {
			width: 26px;
			height: 26px;
			border-radius: 4px;
			border: 1px solid #cccccc;
			background: #f0f0f0;
			cursor: pointer;
			font-size: 1rem;
			font-weight: 600;
			line-height: 1;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.owned-btn:hover {
			background: #dddddd;
		}

		/* Empty state */
		.empty-state {
			color: #888888;
			padding: 48px 24px;
			text-align: center;
			font-size: 1rem;
			grid-column: 1 / -1;
		}

		/* Import dialog */
		#import-dialog {
			border: none;
			border-radius: 10px;
			padding: 0;
			background: #ffffff;
			color: #111111;
			width: 420px;
			max-width: 90vw;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
		}

		#import-dialog::backdrop {
			background: rgba(0, 0, 0, 0.65);
		}

		.dialog-inner {
			padding: 24px;
			display: flex;
			flex-direction: column;
			gap: 16px;
		}

		.dialog-title {
			font-size: 1.1rem;
			font-weight: 700;
		}

		.dialog-file-input {
			font-size: 0.9rem;
		}

		.dialog-actions {
			display: flex;
			justify-content: flex-end;
			gap: 8px;
		}

		.dialog-btn-cancel {
			padding: 8px 16px;
			border-radius: 6px;
			border: 1px solid #cccccc;
			background: #f5f5f5;
			color: #333333;
			font-size: 0.9rem;
			cursor: pointer;
		}

		.dialog-btn-cancel:hover {
			background: #e8e8e8;
		}

		.dialog-btn-submit {
			padding: 8px 16px;
			border-radius: 6px;
			border: none;
			background: #1f1f1f;
			color: #ffffff;
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
		}

		.dialog-btn-submit:hover {
			background: #3a3a3a;
		}

		.import-status {
			font-size: 0.85rem;
			min-height: 1em;
			color: #cc0000;
		}
	</style>
</head>
<body>

<div class="top-bar">
	<input
		class="search-input"
		type="search"
		name="q"
		placeholder="Search cards..."
		autocomplete="off"
		hx-get="/cards/search/html"
		hx-trigger="input changed delay:300ms"
		hx-target="#card-grid"
		hx-swap="innerHTML"
	>
	<button class="import-btn" onclick="document.getElementById('import-dialog').showModal()">
		Import
	</button>
	<a class="nav-link" href="/wishlist">Wishlist</a>
</div>

<div
	id="card-grid"
	hx-get="/cards/search/html"
	hx-trigger="cardsImported from:body"
	hx-swap="innerHTML"
>
	{{template "cards" .}}
</div>

<dialog id="import-dialog">
	<div class="dialog-inner">
		<div class="dialog-title">Import Cards from CSV</div>
		<form
			hx-post="/cards/import/html"
			hx-encoding="multipart/form-data"
			hx-target="#import-status"
			hx-swap="innerHTML"
			hx-on::after-request="if(event.detail.successful){ document.getElementById('import-dialog').close(); htmx.trigger(document.body, 'cardsImported'); }"
		>
			<input class="dialog-file-input" type="file" name="file" accept=".csv" required>
			<div class="dialog-actions" style="margin-top: 16px;">
				<button
					type="button"
					class="dialog-btn-cancel"
					onclick="document.getElementById('import-dialog').close()"
				>Cancel</button>
				<button type="submit" class="dialog-btn-submit">Import</button>
			</div>
		</form>
		<div id="import-status" class="import-status"></div>
	</div>
</dialog>

</body>
</html>
{{end}}
